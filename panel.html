<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<style>
    /* Estilos extra para profesionalismo */
    .card {
        border: none;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }
    
    .nav-btn {
        display: flex;
        align-items: center;
        gap: 10px;
        transition: transform 0.2s;
    }
    
    .nav-btn:active { transform: scale(0.95); }

    /* Animación de entrada para las secciones */
    #view-lista, #view-nuevo {
        animation: fadeIn 0.4s ease-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Badge de estado mejorado */
    .status-badge {
        background: #dcfce7;
        color: #166534;
        padding: 6px 12px;
        border-radius: 99px;
        font-weight: 600;
    }
</style>

<script>
    // Función profesional para mostrar mensajes
    function mostrarMensaje(texto, color = "#2563eb") {
        Toastify({
            text: texto,
            duration: 3000,
            gravity: "top",
            position: "right",
            style: { background: color, borderRadius: "8px" }
        }).showToast();
    }

    async function crearTicket() {
        const btn = document.getElementById('btn-crear');
        const originalText = btn.innerText;
        
        // Efecto visual de carga
        btn.disabled = true;
        btn.innerHTML = `<span class="spinner"></span> Enviando...`;

        const nuevoTicket = {
            creado_por: currentUserId,
            patente: document.getElementById('patente').value.toUpperCase(),
            zona: document.getElementById('zona').value.toUpperCase(),
            "tipo de consulta": document.getElementById('tipo_consulta_input').value,
            descripcion: document.getElementById('descripcion').value,
            estado: 'Pendiente'
        };

        // Validación simple
        if(!nuevoTicket.patente || !nuevoTicket.descripcion) {
            mostrarMensaje("⚠️ Por favor completa los campos obligatorios", "#ef4444");
            btn.disabled = false;
            btn.innerText = originalText;
            return;
        }

        const { error } = await _supabase.from('Tickets').insert([nuevoTicket]);

        if (error) {
            mostrarMensaje("❌ Error: " + error.message, "#ef4444");
            btn.disabled = false;
            btn.innerText = originalText;
        } else {
            mostrarMensaje("✅ Ticket enviado a Operaciones con éxito");
            
            // Limpieza fluida
            document.querySelectorAll('input, textarea').forEach(el => el.value = '');
            btn.disabled = false;
            btn.innerText = originalText;
            
            // Volver a la lista con una pequeña espera para el efecto
            setTimeout(() => {
                verSeccion('lista');
                cargarTickets();
            }, 500);
        }
    }
</script>
