<!DOCTYPE html>
<html>
<head>
    <title>Carflex - Panel General</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
        .box { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 900px; margin: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #2563eb; color: white; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #ddd; }
        .btn-crear { padding: 10px 20px; background: #22c55e; color: white; border: none; border-radius: 4px; text-decoration: none; font-weight: bold; }
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; background: #e2e8f0; }
    </style>
</head>
<body>
    <div class="box">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <h2>Panel de Tickets</h2>
            <a href="nuevo.html" class="btn-crear">+ Crear Nuevo Ticket</a>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Agente</th>
                    <th>Patente</th>
                    <th>Estado</th>
                    <th>Fecha</th>
                </tr>
            </thead>
            <tbody id="tabla-total">
                <tr><td colspan="4" style="text-align:center;">Cargando todos los registros...</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        const _supabase = supabase.createClient('TU_URL', 'TU_KEY');

        async function cargarTodo() {
            const { data, error } = await _supabase
                .from('Tickets')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                alert("Error: " + error.message);
                return;
            }

            const tbody = document.getElementById('tabla-total');
            tbody.innerHTML = data.map(t => `
                <tr>
                    <td><strong>${t.agente || 'S/N'}</strong></td>
                    <td>${t.patente}</td>
                    <td><span class="badge">${t.estado || 'Pendiente'}</span></td>
                    <td>${new Date(t.created_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
        }

        window.onload = cargarTodo;
    </script>
</body>
</html>
