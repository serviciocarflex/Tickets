<!DOCTYPE html>
<html>
<head>
    <title>Carflex - Listado Total</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
        .box { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 1000px; margin: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #2563eb; color: white; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #ddd; }
        .btn-crear { padding: 10px 20px; background: #22c55e; color: white; border: none; border-radius: 4px; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <div class="box">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <h2>Registro de Tickets</h2>
            <a href="nuevo.html" class="btn-crear">+ Nuevo</a>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Patente</th>
                    <th>Estado</th>
                    <th>Fecha</th>
                </tr>
            </thead>
            <tbody id="tabla-total">
                <tr><td colspan="3" style="text-align:center;">Cargando registros...</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        // ASEGÚRATE DE QUE ESTO SEA EXACTO
        const _supabase = supabase.createClient('TU_URL', 'TU_KEY');

        async function cargarTodo() {
            const tbody = document.getElementById('tabla-total');
            try {
                // Traemos todo de la tabla 'Tickets'
                const { data, error } = await _supabase
                    .from('Tickets')
                    .select('*');

                if (error) throw error;

                if (data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;">La tabla está vacía en Supabase.</td></tr>';
                } else {
                    tbody.innerHTML = data.map(t => `
                        <tr>
                            <td><strong>${t.patente || 'S/P'}</strong></td>
                            <td>${t.estado || 'Pendiente'}</td>
                            <td>${new Date(t.created_at || t.create_at).toLocaleDateString()}</td>
                        </tr>
                    `).join('');
                }
            } catch (err) {
                tbody.innerHTML = `<tr><td colspan="3" style="color:red; text-align:center;">Error: ${err.message}</td></tr>`;
            }
        }
        window.onload = cargarTodo;
    </script>
</body>
</html>
